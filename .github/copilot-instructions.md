# Copilot Instructions for doc_ai_helper_backend

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯GitHub CopilotãŒ`doc_ai_helper_backend`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚ˆã‚Šè‰¯ãç†è§£ã—ã€é©åˆ‡ãªææ¡ˆã‚’è¡Œã†ãŸã‚ã®æŒ‡ç¤ºæ›¸ã§ã™ã€‚

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

`doc_ai_helper_backend`ã¯ã€Gitã‚µãƒ¼ãƒ“ã‚¹ã§ãƒ›ã‚¹ãƒˆã•ã‚ŒãŸMarkdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ã—ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«æä¾›ã™ã‚‹ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã§ã™ã€‚åå‰ã¯`doc_ai_helper_backend`ã§ã™ã€‚å°†æ¥çš„ã«ã¯Quartoãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚ã‚µãƒãƒ¼ãƒˆã™ã‚‹äºˆå®šã§ã™ã€‚

### ä¸»ãªç”¨é€”

1. **Markdownãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ãŸã‚ã®Markdownã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æä¾›
2. **LLMã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰LLMã«å•ã„åˆã‚ã›ã‚‹ãŸã‚ã®å…ƒãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.mdï¼‰ã‚’æä¾›
3. **HTMLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¡¨ç¤º**: ï¼ˆå°†æ¥æ©Ÿèƒ½ï¼‰Quartoã§ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸãƒªãƒã‚¸ãƒˆãƒªå†…ã®HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«æä¾›

### å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

æ®µéšçš„ãªå®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ï¼š

1. **Markdownã‚µãƒãƒ¼ãƒˆï¼ˆãƒ•ã‚§ãƒ¼ã‚º1ï¼‰**: ã¾ãšMarkdownãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—ãƒ»å‡¦ç†æ©Ÿèƒ½ã‚’å®Œå…¨ã«å®Ÿè£… [âœ…å®Œäº†]
   - åŸºæœ¬çš„ãªMarkdownãƒ•ã‚¡ã‚¤ãƒ«å–å¾—ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æä¾›
   - ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼è§£æã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æŠ½å‡º
   - ãƒªãƒ³ã‚¯æƒ…å ±ã®æŠ½å‡ºã¨å¤‰æ›
   - æ‹¡å¼µãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®æä¾›

2. **æ‹¡å¼µæ©Ÿèƒ½ï¼ˆãƒ•ã‚§ãƒ¼ã‚º2ï¼‰**: ãã®ä»–ã®æ©Ÿèƒ½æ‹¡å¼µ [ğŸ”„é€²è¡Œä¸­]
   - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰çµŒç”±LLM APIé€£æºã®å®Ÿè£… [ğŸ”„å„ªå…ˆå®Ÿè£…é …ç›®]
   - ãƒªãƒã‚¸ãƒˆãƒªç®¡ç†æ©Ÿèƒ½ã®å®Ÿè£…
   - æ¤œç´¢æ©Ÿèƒ½ã®å®Ÿè£…
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®å¼·åŒ–
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®æœ€é©åŒ–

3. **Quartoã‚µãƒãƒ¼ãƒˆï¼ˆãƒ•ã‚§ãƒ¼ã‚º3ï¼‰**: Quartoãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç‰¹æ®Šæ©Ÿèƒ½ï¼ˆã‚½ãƒ¼ã‚¹ã¨å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®é–¢é€£ä»˜ã‘ãªã©ï¼‰ã‚’è¿½åŠ  [â±ï¸å°†æ¥å¯¾å¿œ]

ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚Šã€åŸºæœ¬æ©Ÿèƒ½ã‚’æ—©æœŸã«æä¾›ã—ãªãŒã‚‰ã€å¾ã€…ã«é«˜åº¦ãªæ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¦ã„ãã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

## ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰çµŒç”±LLM APIé€£æº

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ‹¡å¼µã¨ã—ã¦ã€å¤–éƒ¨LLM APIã¨ã®é€£æºã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰çµŒç”±ã§å®Ÿè£…ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šä»¥ä¸‹ã®åˆ©ç‚¹ãŒå¾—ã‚‰ã‚Œã¾ã™ï¼š

### LLMã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…æ¦‚è¦

LLMã‚µãƒ¼ãƒ“ã‚¹å±¤ã¯ã€ã‚¯ãƒªãƒ¼ãƒ³ãªæŠ½è±¡åŒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é€šã˜ã¦æ§˜ã€…ãªLLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆOpenAIã€Anthropicãªã©ï¼‰ã¨å¯¾è©±ã™ã‚‹ãŸã‚ã®çµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚å®Ÿè£…ã¯é–¢å¿ƒäº‹ã®æ˜ç¢ºãªåˆ†é›¢ã‚’æŒã¤ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼è¨­è¨ˆã«å¾“ã£ã¦ã„ã¾ã™ï¼š

#### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

1. **ãƒ™ãƒ¼ã‚¹LLMã‚µãƒ¼ãƒ“ã‚¹ï¼ˆ`base.py`ï¼‰**
   - ã™ã¹ã¦ã®LLMã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…ã«å…±é€šã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©
   - `query()`ï¼šLLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’é€ä¿¡
   - `stream_query()`ï¼šã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã§LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’é€ä¿¡
   - `get_capabilities()`ï¼šãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®æ©Ÿèƒ½ã‚’å–å¾—
   - `format_prompt()`ï¼šå¤‰æ•°ã‚’ä½¿ç”¨ã—ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
   - `estimate_tokens()`ï¼šä¾¡æ ¼/åˆ¶é™ã®ãŸã‚ã®ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã‚’æ¨å®š

2. **LLMã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ï¼ˆ`factory.py`ï¼‰**
   - é©åˆ‡ãªLLMã‚µãƒ¼ãƒ“ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³
   - ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®å‹•çš„ç™»éŒ²ã‚’ã‚µãƒãƒ¼ãƒˆ
   - ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®šã‚’ç®¡ç†

3. **OpenAIã‚µãƒ¼ãƒ“ã‚¹ï¼ˆ`openai_service.py`ï¼‰**
   - OpenAI APIã¨ã®é€šä¿¡ã‚’å®Ÿè£…
   - Chat Completions APIã‚’ä½¿ç”¨ã—ãŸæ¨™æº–çš„ãªã‚¯ã‚¨ãƒªå‡¦ç†
   - ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚µãƒãƒ¼ãƒˆ
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã«ã‚ˆã‚‹APIå‘¼ã³å‡ºã—ã®æœ€é©åŒ–
   - ã‚«ã‚¹ã‚¿ãƒ ãƒ™ãƒ¼ã‚¹URLã®ã‚µãƒãƒ¼ãƒˆï¼ˆLiteLLMãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ãªã©ã¨é€£æºå¯èƒ½ï¼‰
   - ãƒˆãƒ¼ã‚¯ãƒ³è¦‹ç©ã‚‚ã‚Šã®ãŸã‚ã®tiktokenãƒ©ã‚¤ãƒ–ãƒ©ãƒªçµ±åˆ
   - ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨ãƒ­ã‚®ãƒ³ã‚°æ©Ÿèƒ½
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã‚·ã‚¹ãƒ†ãƒ ã‚¤ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’å«ã‚€è¤‡é›‘ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ§‹é€ ã®ã‚µãƒãƒ¼ãƒˆ

4. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆ`cache_service.py`ï¼‰**
   - LLMãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãŸã‚ã®ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å®Ÿè£…
   - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‹ã‚‰æ±ºå®šè«–çš„ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã‚’ç”Ÿæˆ
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¢ã‚¤ãƒ†ãƒ ã®TTLï¼ˆTime-To-Liveï¼‰ã‚’å®Ÿè£…
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨æœŸé™åˆ‡ã‚Œã‚¢ã‚¤ãƒ†ãƒ ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹ãŸã‚ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›

5. **MCPã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ï¼ˆ`mcp_adapter.py`ï¼‰**
   - Model Context Protocolã«å¾“ã£ã¦ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å‡¦ç†
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ¨™æº–åŒ–ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã«å¤‰æ›
   - ãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™å†…ã«åã¾ã‚‹ã‚ˆã†ã«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æœ€é©åŒ–
   - é–¢é€£æ€§ã«åŸºã¥ã„ã¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å„ªå…ˆé †ä½ä»˜ã‘

6. **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼ˆ`template_manager.py`ï¼‰**
   - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç®¡ç†ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã‚’æä¾›
   - JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã¿
   - å¤‰æ•°ç½®æ›ã«ã‚ˆã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
   - å¿…é ˆå¤‰æ•°ã®æ¤œè¨¼

#### å®Ÿè£…çŠ¶æ³

- âœ… LLMã‚µãƒ¼ãƒ“ã‚¹åŸºæœ¬ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®è¨­è¨ˆã¨å®Ÿè£…
- âœ… æŠ½è±¡åŸºåº•ã‚¯ãƒ©ã‚¹ï¼ˆ`LLMServiceBase`ï¼‰ã®å®Ÿè£…
- âœ… ã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ï¼ˆ`LLMServiceFactory`ï¼‰ã®å®Ÿè£…
- âœ… ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆ`LLMCacheService`ï¼‰ã®å®Ÿè£…
- âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ`PromptTemplateManager`ï¼‰ã®å®Ÿè£…
- âœ… ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆ`MockLLMService`ï¼‰ã®å®Ÿè£…
- âœ… OpenAIã‚µãƒ¼ãƒ“ã‚¹ï¼ˆ`OpenAIService`ï¼‰ã®å®Ÿè£…ã¨å˜ä½“ãƒ†ã‚¹ãƒˆå®Œäº†
- âœ… ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚µãƒãƒ¼ãƒˆï¼ˆ2025å¹´6æœˆå®Œäº†ï¼‰
- âœ… SSEï¼ˆServer-Sent Eventsï¼‰ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å®Ÿè£…
- âœ… MCPã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ï¼ˆ`MCPAdapter`ï¼‰ã®åŸºæœ¬å®Ÿè£…
- ğŸ”„ è¿½åŠ ã®LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å®Ÿè£…ï¼ˆOllamaã€æœ€å„ªå…ˆï¼‰- 2025å¹´7æœˆä¸­å®Œäº†äºˆå®š
- ğŸ”„ MCPã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®æ‹¡å¼µæ©Ÿèƒ½ï¼ˆå¾Œç¶šãƒ•ã‚§ãƒ¼ã‚ºï¼‰

#### Ollamaã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…è¨ˆç”»

Ollamaã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…ã¯ã€æ¬¡ã®å„ªå…ˆå®Ÿè£…é …ç›®ã¨ã—ã¦ä½ç½®ã¥ã‘ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚Ollamaã¯ã€è»½é‡ãªãƒ­ãƒ¼ã‚«ãƒ«LLMã‚µãƒ¼ãƒãƒ¼ã§ã‚ã‚Šã€ä»¥ä¸‹ã®ç‰¹å¾´ãŒã‚ã‚Šã¾ã™ï¼š

1. **ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œ**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é…å»¶ã®å°‘ãªã„é«˜é€Ÿãªãƒ¬ã‚¹ãƒãƒ³ã‚¹
2. **ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«**: æ§˜ã€…ãªã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«ã®ã‚µãƒãƒ¼ãƒˆ
3. **ãƒªã‚½ãƒ¼ã‚¹åŠ¹ç‡**: é™ã‚‰ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã§ã®åŠ¹ç‡çš„ãªå®Ÿè¡Œ

å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¨ã—ã¦ã¯ã€ä»¥ä¸‹ã‚’äºˆå®šã—ã¦ã„ã¾ã™ï¼š

1. **åŸºæœ¬ã‚¯ãƒ©ã‚¹ã®å®Ÿè£…**
   - `OllamaService` ã‚¯ãƒ©ã‚¹ã®ä½œæˆï¼ˆ`LLMServiceBase` ã‚’ç¶™æ‰¿ï¼‰
   - Ollama APIã¨ã®é€šä¿¡å®Ÿè£…ï¼ˆhttpxã‚’ä½¿ç”¨ï¼‰
   - åŸºæœ¬çš„ãªã‚¯ã‚¨ãƒªæ©Ÿèƒ½ã®å®Ÿè£…

2. **æ‹¡å¼µæ©Ÿèƒ½**
   - ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚µãƒãƒ¼ãƒˆã®å®Ÿè£…ï¼ˆOllamaã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã‚’æ´»ç”¨ï¼‰
   - ãƒ¢ãƒ‡ãƒ«ç®¡ç†æ©Ÿèƒ½ã®è¿½åŠ ï¼ˆåˆ©ç”¨å¯èƒ½ãªãƒ¢ãƒ‡ãƒ«ã®å–å¾—ã€ãƒ¢ãƒ‡ãƒ«åˆ‡ã‚Šæ›¿ãˆï¼‰
   - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼æœ€é©åŒ–ï¼ˆæ¸©åº¦ã€ãƒˆãƒƒãƒ—Pã€ç¹°ã‚Šè¿”ã—ãƒšãƒŠãƒ«ãƒ†ã‚£ãªã©ï¼‰

3. **çµ±åˆãƒ†ã‚¹ãƒˆ**
   - å˜ä½“ãƒ†ã‚¹ãƒˆã¨çµ±åˆãƒ†ã‚¹ãƒˆã®å®Ÿè£…
   - ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®æ¤œè¨¼ï¼ˆã‚¨ãƒ©ãƒ¼å‡¦ç†ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€å¤§ããªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼‰
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š

#### ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å®Ÿè£…çŠ¶æ³

ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚µãƒãƒ¼ãƒˆã¯å®Œå…¨ã«å®Ÿè£…ã•ã‚Œã€ãƒ†ã‚¹ãƒˆæ¸ˆã¿ã§ã™ã€‚å®Ÿè£…ã«ã¯ä»¥ä¸‹ã®è¦ç´ ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼š

1. **åŸºæœ¬ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®æ‹¡å¼µ**
   - `LLMServiceBase`ã‚¯ãƒ©ã‚¹ã«`stream_query`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ 
   - AsyncGeneratorã‚’è¿”ã™éåŒæœŸãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…
   - å…¨ã¦ã®å®Ÿè£…ï¼ˆOpenAIã€Mockï¼‰ã§ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚µãƒãƒ¼ãƒˆ

2. **OpenAIã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…**
   - OpenAI APIã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰å®Œå…¨å¯¾å¿œ
   - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿é‡è¤‡ãƒã‚°ã®ä¿®æ­£ï¼ˆ`model`ã¨`stream`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®é‡è¤‡ã‚’å›é¿ï¼‰
   - ãƒãƒ£ãƒ³ã‚¯å‡¦ç†ã¨ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼å®Ÿè£…ã®æœ€é©åŒ–
   - åŒ…æ‹¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®è¿½åŠ 

3. **APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…**
   - SSEï¼ˆServer-Sent Eventsï¼‰ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å®Œå…¨å®Ÿè£…
   - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ã®é€£æºãƒ†ã‚¹ãƒˆå®Œäº†

OpenAIã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å®Ÿè£…ä¾‹:

```python
async def stream_query(
    self, prompt: str, options: Optional[Dict[str, Any]] = None
) -> AsyncGenerator[str, None]:
    """ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã§OpenAI APIã«ã‚¯ã‚¨ãƒªã‚’é€ä¿¡ã™ã‚‹"""
    options = options or {}
    query_options = self._prepare_options(prompt, options)
    model = query_options.get("model", self.default_model)
    
    try:
        # OpenAI APIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
        messages = query_options.pop("messages")
        # modelã‚­ãƒ¼ã¨streamã‚­ãƒ¼ã‚’query_optionsã‹ã‚‰å‰Šé™¤ã—ã¦é‡è¤‡ã‚’é˜²ã
        query_options.pop("model", None)
        query_options.pop("stream", None)
        
        # ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å–å¾—
        stream = await self.async_client.chat.completions.create(
            model=model,
            messages=messages,
            stream=True,
            **query_options
        )
        
        # ãƒãƒ£ãƒ³ã‚¯ã‚’é †æ¬¡ç”Ÿæˆ
        async for chunk in stream:
            if chunk.choices and chunk.choices[0].delta.content:                yield chunk.choices[0].delta.content
                
    except Exception as e:
        logger.error(f"Error in streaming query: {str(e)}")
        raise LLMServiceException(f"Streaming error: {str(e)}")
```

## å®Ÿè£…è¨ˆç”»

### ç¾åœ¨ã®çŠ¶æ³
- ç’°å¢ƒæ§‹ç¯‰å®Œäº†
- ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆä½œæˆæ¸ˆã¿
- åŸºæœ¬çš„ãªAPIãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®è¨­å®šå®Œäº†
- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯APIã®å®Ÿè£…å®Œäº†
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå–å¾—APIã®åŸºæœ¬æ©Ÿèƒ½å®Ÿè£…å®Œäº†
- ãƒªãƒã‚¸ãƒˆãƒªæ§‹é€ å–å¾—APIã®åŸºæœ¬æ©Ÿèƒ½å®Ÿè£…å®Œäº†
- Mockã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…å®Œäº†ï¼ˆé–‹ç™ºãƒ»ãƒ‡ãƒ¢ãƒ»ãƒ†ã‚¹ãƒˆç”¨ï¼‰
- LLMã‚µãƒ¼ãƒ“ã‚¹å±¤ã®åŸºæœ¬å®Ÿè£…å®Œäº†ï¼ˆOpenAIã€ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚µãƒãƒ¼ãƒˆå«ã‚€ï¼‰

**å®Ÿè£…æ–¹é‡ã®æ˜ç¢ºåŒ–**:
- Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå¯¾å¿œã‚’æœ€å„ªå…ˆã§å®Ÿè£… [âœ…å®Œäº†]
- LLM APIé€£æºã®åŸºæœ¬æ©Ÿèƒ½å®Ÿè£… [âœ…å®Œäº†]
- Ollamaã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…ã‚’æ¬¡ã®å„ªå…ˆé …ç›®ã¨ã—ã¦æ¨é€² [ğŸ”„é€²è¡Œä¸­]
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å±¤ã¯ãƒ¢ãƒƒã‚¯ã§å®Ÿè£…ï¼ˆAPIã®ä»•æ§˜ãŒå®šã¾ã£ãŸæ®µéšã§ãƒ¢ãƒ‡ãƒ«å®šç¾©ã‚’è¡Œã†ï¼‰
- Quartoå¯¾å¿œã¯å°†æ¥ã®æ‹¡å¼µã¨ã—ã¦ä½ç½®ä»˜ã‘

## å®Ÿè£…è¨ˆç”»

### ç¾åœ¨ã®çŠ¶æ³
- ç’°å¢ƒæ§‹ç¯‰å®Œäº†
- ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆä½œæˆæ¸ˆã¿
- åŸºæœ¬çš„ãªAPIãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®è¨­å®šå®Œäº†
- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯APIã®å®Ÿè£…å®Œäº†
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå–å¾—APIã®åŸºæœ¬æ©Ÿèƒ½å®Ÿè£…å®Œäº†
- ãƒªãƒã‚¸ãƒˆãƒªæ§‹é€ å–å¾—APIã®åŸºæœ¬æ©Ÿèƒ½å®Ÿè£…å®Œäº†
- Mockã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…å®Œäº†ï¼ˆé–‹ç™ºãƒ»ãƒ‡ãƒ¢ãƒ»ãƒ†ã‚¹ãƒˆç”¨ï¼‰
- LLMã‚µãƒ¼ãƒ“ã‚¹å±¤ã®åŸºæœ¬å®Ÿè£…å®Œäº†ï¼ˆOpenAIã€ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚µãƒãƒ¼ãƒˆå«ã‚€ï¼‰

**å®Ÿè£…æ–¹é‡ã®æ˜ç¢ºåŒ–**:
- Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå¯¾å¿œã‚’æœ€å„ªå…ˆã§å®Ÿè£… [âœ…å®Œäº†]
- LLM APIé€£æºã®åŸºæœ¬æ©Ÿèƒ½å®Ÿè£… [âœ…å®Œäº†]
- Ollamaã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…ã‚’æ¬¡ã®å„ªå…ˆé …ç›®ã¨ã—ã¦æ¨é€² [ğŸ”„é€²è¡Œä¸­]
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å±¤ã¯ãƒ¢ãƒƒã‚¯ã§å®Ÿè£…ï¼ˆAPIã®ä»•æ§˜ãŒå®šã¾ã£ãŸæ®µéšã§ãƒ¢ãƒ‡ãƒ«å®šç¾©ã‚’è¡Œã†ï¼‰
- Quartoå¯¾å¿œã¯å°†æ¥ã®æ‹¡å¼µã¨ã—ã¦ä½ç½®ä»˜ã‘

### é–‹ç™ºã‚¹ãƒ†ãƒƒãƒ—
1. **åŸºæœ¬APIå®šç¾©ã®å®Œäº†** [âœ…å®Œäº†]
   - RESTful APIã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©
   - ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®Pydanticãƒ¢ãƒ‡ãƒ«å®šç¾©
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å®Ÿè£…

2. **ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®å®Ÿè£…** [âœ…å®Œäº†]
   - æŠ½è±¡Gitã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…ï¼ˆ`services/git/base.py`ï¼‰
   - GitHubå®Ÿè£…ï¼ˆ`services/git/github_service.py`ï¼‰
   - Mockå®Ÿè£…ï¼ˆ`services/git/mock_service.py`ï¼‰   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‡¦ç†ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆ`services/document_service.py`ï¼‰
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆåŸºæœ¬å®Ÿè£…ï¼‰
   - LLMã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…ï¼ˆ`services/llm/`ï¼‰

3. **ãƒ¢ãƒƒã‚¯ã‚’ç”¨ã„ãŸAPIã®å‹•ä½œç¢ºèª** [âœ…å®Œäº†]
   - å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãªã—ã§ã‚µãƒ¼ãƒ“ã‚¹å±¤ã‚’ãƒ¢ãƒƒã‚¯ã—ã¦APIã®å‹•ä½œã‚’ç¢ºèª
   - ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®æ‰‹æ³•ã‚’æ´»ç”¨ã—ã€APIã®æœŸå¾…ã™ã‚‹å‹•ä½œã‚’ãƒ†ã‚¹ãƒˆã§å®šç¾©

4. **Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå¯¾å¿œã®æ‹¡å¼µ** [âœ…å®Œäº†]
   - Markdownãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼è§£æ
   - ç›¸å¯¾ãƒªãƒ³ã‚¯ã®çµ¶å¯¾ãƒ‘ã‚¹å¤‰æ›æ©Ÿèƒ½
   - ãƒªãƒ³ã‚¯æƒ…å ±ã®æŠ½å‡ºã¨æä¾›
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®æ‹¡å……
   
5. **LLM APIé€£æºã®å®Ÿè£…** [âœ…éƒ¨åˆ†çš„ã«å®Œäº†]
   - LLMã‚µãƒ¼ãƒ“ã‚¹æŠ½è±¡åŒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å®Ÿè£…ï¼ˆ`services/llm/base.py`ï¼‰ [âœ…å®Œäº†]
   - ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å›ºæœ‰ã®å®Ÿè£…ï¼ˆOpenAI, ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒ“ã‚¹ï¼‰ [âœ…å®Œäº†]
   - `LLMServiceFactory` ã®å®Ÿè£…ï¼ˆ`services/llm/factory.py`ï¼‰ [âœ…å®Œäº†]
   - MCPã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®å®Ÿè£…ï¼ˆ`services/llm/mcp_adapter.py`ï¼‰ [âœ…åŸºæœ¬å®Ÿè£…å®Œäº†]
   - LLMå•ã„åˆã‚ã›ç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è¿½åŠ ï¼ˆ`api/endpoints/llm.py`ï¼‰ [âœ…å®Œäº†]
   - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†æ©Ÿèƒ½ã®å®Ÿè£… [âœ…å®Œäº†]
   - ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å®Ÿè£… [âœ…å®Œäº†]
   - ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚µãƒãƒ¼ãƒˆ [âœ…å®Œäº†]
   - SSEï¼ˆServer-Sent Eventsï¼‰ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å®Ÿè£… [âœ…å®Œäº†]
   - è¿½åŠ ã®LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å®Ÿè£…ï¼ˆOllamaï¼‰ [ğŸ”„é€²è¡Œä¸­]
   - MCPã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®æ‹¡å¼µæ©Ÿèƒ½ [ğŸ”„è¨ˆç”»ä¸­]

6. **APIã®æ‹¡å¼µï¼ˆQuartoå¯¾å¿œã‚’è¦‹æ®ãˆãŸæ©Ÿèƒ½ï¼‰** [ğŸ”„è¨ˆç”»ä¸­]
   - Quartoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¤œå‡ºæ©Ÿèƒ½ã®è¿½åŠ 
   - ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã¨å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®é–¢é€£ä»˜ã‘ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
   - ãƒªãƒ³ã‚¯å¤‰æ›ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è¿½åŠ 
   - ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼è§£æã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æä¾›æ©Ÿèƒ½ã®æ‹¡å¼µ
   - ãƒªãƒã‚¸ãƒˆãƒªè¨­å®šãƒ¢ãƒ‡ãƒ«ã¨APIã®è¿½åŠ 

7. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å±¤ã®å®Ÿè£…** [ğŸ”„é€²è¡Œäºˆå®š]
   - SQLAlchemyã®Baseã‚¯ãƒ©ã‚¹ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã®è¨­å®šï¼ˆ`db/database.py`ï¼‰
   - ãƒ¢ãƒ‡ãƒ«å®šç¾©ï¼ˆ`db/models.py`ï¼‰
   - ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤ã®å®Ÿè£…ï¼ˆ`db/repositories/`ï¼‰
   - Alembicã«ã‚ˆã‚‹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
   - ãƒªãƒã‚¸ãƒˆãƒªè¨­å®šãƒ»ãƒãƒƒãƒ”ãƒ³ã‚°æ©Ÿèƒ½ã®è¿½åŠ 

8. **Quartoãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå¯¾å¿œã®è¿½åŠ ** [â±ï¸æœªç€æ‰‹]
   - Quartoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šï¼ˆ_quarto.ymlï¼‰ã®è§£æ
   - ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«(.qmd)ã¨å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«(.html)ã®é–¢é€£ä»˜ã‘
   - ãƒªãƒã‚¸ãƒˆãƒªæ§‹é€ åˆ†æã¨ãƒ‘ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚°
   - ã‚µã‚¤ãƒˆæ§‹é€ æƒ…å ±ã®æä¾›

9. **ãƒ†ã‚¹ãƒˆã®å……å®Ÿ** [ğŸ”„éƒ¨åˆ†çš„ã«å®Œäº†]
   - APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå–å¾—ã€æ§‹é€ å–å¾—ï¼‰[âœ…å®Œäº†]
   - çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆå®Ÿéš›ã®DBã‚’ä½¿ã£ãŸå…¨ä½“çš„ãªãƒ•ãƒ­ãƒ¼ç¢ºèªï¼‰
   - ãƒ¢ãƒƒã‚¯ã‚’ä½¿ã£ãŸå¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ†ã‚¹ãƒˆ [âœ…å®Œäº†]
   - Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½ã®æ‹¡å¼µãƒ†ã‚¹ãƒˆ [âœ…å®Œäº†]
   - LLMã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ†ã‚¹ãƒˆ [âœ…å®Œäº†]
   - å°†æ¥çš„ãªQuartoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå¯¾å¿œã®ãƒ†ã‚¹ãƒˆ [â±ï¸æœªç€æ‰‹]

10. **ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã¨ã‚³ãƒ¼ãƒ‰å“è³ªå‘ä¸Š** [ğŸ”„éƒ¨åˆ†çš„ã«å®Œäº†]
    - ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒ†ã‚¹ãƒˆç”¨ã‹ã‚‰ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã¸ç§»è¡Œ [âœ…å®Œäº†]
    - APIãƒ‘ã‚¹ã®æ•´ç†ï¼ˆ`/contents`ã¨`/structure`ã®æ˜ç¢ºãªåˆ†é›¢ï¼‰[âœ…å®Œäº†]
    - Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‡¦ç†ã®å¼·åŒ– [âœ…å®Œäº†]
    - LLMã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ– [âœ…å®Œäº†]
    - ãƒ­ã‚°å‡ºåŠ›ã®å¼·åŒ– [ğŸ”„è¨ˆç”»ä¸­]
    - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ– [ğŸ”„è¨ˆç”»ä¸­]
    - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã®å¼·åŒ– [ğŸ”„è¨ˆç”»ä¸­]

3. **ãƒ¢ãƒƒã‚¯ã‚’ç”¨ã„ãŸAPIã®å‹•ä½œç¢ºèª** [âœ…å®Œäº†]
   - å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãªã—ã§ã‚µãƒ¼ãƒ“ã‚¹å±¤ã‚’ãƒ¢ãƒƒã‚¯ã—ã¦APIã®å‹•ä½œã‚’ç¢ºèª
   - ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®æ‰‹æ³•ã‚’æ´»ç”¨ã—ã€APIã®æœŸå¾…ã™ã‚‹å‹•ä½œã‚’ãƒ†ã‚¹ãƒˆã§å®šç¾©

4. **Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå¯¾å¿œã®æ‹¡å¼µ** [âœ…å®Œäº†]
   - Markdownãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼è§£æ
   - ç›¸å¯¾ãƒªãƒ³ã‚¯ã®çµ¶å¯¾ãƒ‘ã‚¹å¤‰æ›æ©Ÿèƒ½
   - ãƒªãƒ³ã‚¯æƒ…å ±ã®æŠ½å‡ºã¨æä¾›
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®æ‹¡å……
   
5. **LLM APIé€£æºã®å®Ÿè£…** [âœ…éƒ¨åˆ†çš„ã«å®Œäº†]
   - LLMã‚µãƒ¼ãƒ“ã‚¹æŠ½è±¡åŒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å®Ÿè£…ï¼ˆ`services/llm/base.py`ï¼‰ [âœ…å®Œäº†]
   - ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å›ºæœ‰ã®å®Ÿè£…ï¼ˆOpenAI, ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒ“ã‚¹ï¼‰ [âœ…å®Œäº†]
   - `LLMServiceFactory` ã®å®Ÿè£…ï¼ˆ`services/llm/factory.py`ï¼‰ [âœ…å®Œäº†]
   - MCPã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®å®Ÿè£…ï¼ˆ`services/llm/mcp_adapter.py`ï¼‰ [âœ…åŸºæœ¬å®Ÿè£…å®Œäº†]
   - LLMå•ã„åˆã‚ã›ç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è¿½åŠ ï¼ˆ`api/endpoints/llm.py`ï¼‰ [âœ…å®Œäº†]
   - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†æ©Ÿèƒ½ã®å®Ÿè£… [âœ…å®Œäº†]
   - ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å®Ÿè£… [âœ…å®Œäº†]
   - ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚µãƒãƒ¼ãƒˆ [âœ…å®Œäº†]
   - SSEï¼ˆServer-Sent Eventsï¼‰ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å®Ÿè£… [âœ…å®Œäº†]
   - è¿½åŠ ã®LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å®Ÿè£…ï¼ˆOllamaï¼‰ [ğŸ”„é€²è¡Œä¸­]
   - MCPã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®æ‹¡å¼µæ©Ÿèƒ½ [ğŸ”„è¨ˆç”»ä¸­]

6. **APIã®æ‹¡å¼µï¼ˆQuartoå¯¾å¿œã‚’è¦‹æ®ãˆãŸæ©Ÿèƒ½ï¼‰** [ğŸ”„è¨ˆç”»ä¸­]
   - Quartoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¤œå‡ºæ©Ÿèƒ½ã®è¿½åŠ 
   - ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã¨å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®é–¢é€£ä»˜ã‘ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
   - ãƒªãƒ³ã‚¯å¤‰æ›ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è¿½åŠ 
   - ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼è§£æã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æä¾›æ©Ÿèƒ½ã®æ‹¡å¼µ
   - ãƒªãƒã‚¸ãƒˆãƒªè¨­å®šãƒ¢ãƒ‡ãƒ«ã¨APIã®è¿½åŠ 

7. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å±¤ã®å®Ÿè£…** [ğŸ”„é€²è¡Œäºˆå®š]
   - SQLAlchemyã®Baseã‚¯ãƒ©ã‚¹ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã®è¨­å®šï¼ˆ`db/database.py`ï¼‰
   - ãƒ¢ãƒ‡ãƒ«å®šç¾©ï¼ˆ`db/models.py`ï¼‰
   - ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤ã®å®Ÿè£…ï¼ˆ`db/repositories/`ï¼‰
   - Alembicã«ã‚ˆã‚‹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
   - ãƒªãƒã‚¸ãƒˆãƒªè¨­å®šãƒ»ãƒãƒƒãƒ”ãƒ³ã‚°æ©Ÿèƒ½ã®è¿½åŠ 

8. **Quartoãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå¯¾å¿œã®è¿½åŠ ** [â±ï¸æœªç€æ‰‹]
   - Quartoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šï¼ˆ_quarto.ymlï¼‰ã®è§£æ
   - ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«(.qmd)ã¨å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«(.html)ã®é–¢é€£ä»˜ã‘
   - ãƒªãƒã‚¸ãƒˆãƒªæ§‹é€ åˆ†æã¨ãƒ‘ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚°
   - ã‚µã‚¤ãƒˆæ§‹é€ æƒ…å ±ã®æä¾›

9. **ãƒ†ã‚¹ãƒˆã®å……å®Ÿ** [ğŸ”„éƒ¨åˆ†çš„ã«å®Œäº†]
   - APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå–å¾—ã€æ§‹é€ å–å¾—ï¼‰[âœ…å®Œäº†]
   - çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆå®Ÿéš›ã®DBã‚’ä½¿ã£ãŸå…¨ä½“çš„ãªãƒ•ãƒ­ãƒ¼ç¢ºèªï¼‰
   - ãƒ¢ãƒƒã‚¯ã‚’ä½¿ã£ãŸå¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ†ã‚¹ãƒˆ [âœ…å®Œäº†]
   - Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½ã®æ‹¡å¼µãƒ†ã‚¹ãƒˆ [âœ…å®Œäº†]
   - LLMã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ†ã‚¹ãƒˆ [âœ…å®Œäº†]
   - å°†æ¥çš„ãªQuartoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå¯¾å¿œã®ãƒ†ã‚¹ãƒˆ [â±ï¸æœªç€æ‰‹]

10. **ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã¨ã‚³ãƒ¼ãƒ‰å“è³ªå‘ä¸Š** [ğŸ”„éƒ¨åˆ†çš„ã«å®Œäº†]
    - ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒ†ã‚¹ãƒˆç”¨ã‹ã‚‰ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã¸ç§»è¡Œ [âœ…å®Œäº†]
    - APIãƒ‘ã‚¹ã®æ•´ç†ï¼ˆ`/contents`ã¨`/structure`ã®æ˜ç¢ºãªåˆ†é›¢ï¼‰[âœ…å®Œäº†]
    - Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‡¦ç†ã®å¼·åŒ– [âœ…å®Œäº†]
    - LLMã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ– [âœ…å®Œäº†]
    - ãƒ­ã‚°å‡ºåŠ›ã®å¼·åŒ– [ğŸ”„è¨ˆç”»ä¸­]
    - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ– [ğŸ”„è¨ˆç”»ä¸­]
    - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã®å¼·åŒ– [ğŸ”„è¨ˆç”»ä¸­]

## ä¸»è¦æ©Ÿèƒ½

1. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå–å¾—API** [âœ…åŸºæœ¬å®Ÿè£…æ¸ˆã¿]
   - æ§˜ã€…ãªGitã‚µãƒ¼ãƒ“ã‚¹ï¼ˆGitHub, Mockç­‰ï¼‰ã‹ã‚‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå–å¾—
   - Markdownãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—ã¨æä¾›
   - ãƒªãƒã‚¸ãƒˆãƒªæ§‹é€ ã®å–å¾—
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ãƒªãƒ³ã‚¯ã®è§£æã¨å¤‰æ› [âœ…å®Œäº†]
   - ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼ã®è§£æã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æä¾› [âœ…å®Œäº†]
   - HTMLãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—ã¨æä¾›ï¼ˆåŸºæœ¬å®Ÿè£…æ¸ˆã¿ï¼‰
   - Quarto/HTMLãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚½ãƒ¼ã‚¹ã¨å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®é–¢é€£ä»˜ã‘ï¼ˆå°†æ¥å¯¾å¿œï¼‰

2. **ãƒªãƒã‚¸ãƒˆãƒªç®¡ç†API** [ğŸ”„å®Ÿè£…äºˆå®š]
   - ãƒªãƒã‚¸ãƒˆãƒªæƒ…å ±ã®CRUDæ“ä½œ
   - ãƒªãƒã‚¸ãƒˆãƒªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†
   - Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¨­å®šã®ç®¡ç†
   - å°†æ¥çš„ã«ã¯Quartoãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¨­å®šï¼ˆãƒ‘ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚°ã€å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãªã©ï¼‰ã®ç®¡ç†
   - ãƒªãƒã‚¸ãƒˆãƒªã‚¿ã‚¤ãƒ—ï¼ˆMarkdown/Quartoï¼‰ã®æ¤œå‡ºã¨ç®¡ç†

3. **LLM APIé€£æº** [âœ…éƒ¨åˆ†çš„ã«å®Œäº†]
   - å¤–éƒ¨LLMã‚µãƒ¼ãƒ“ã‚¹ï¼ˆOpenAIï¼‰ã¨ã®çµ±åˆ [âœ…å®Œäº†]
   - ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚µãƒãƒ¼ãƒˆ [âœ…å®Œäº†]
   - SSEï¼ˆServer-Sent Eventsï¼‰ã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¿œç­” [âœ…å®Œäº†]
   - Model Context Protocol (MCP) å¯¾å¿œ [âœ…åŸºæœ¬å®Ÿè£…å®Œäº†]
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æ´»ç”¨ã—ãŸLLMå•ã„åˆã‚ã› [âœ…å®Œäº†]
   - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç† [âœ…å®Œäº†]
   - ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ [âœ…å®Œäº†]
   - è¿½åŠ ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å®Ÿè£…ï¼ˆOllamaï¼‰ [ğŸ”„é€²è¡Œä¸­]
   - MCPã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®æ‹¡å¼µæ©Ÿèƒ½ [ğŸ”„è¨ˆç”»ä¸­]

4. **æ¤œç´¢API** [ğŸ”„å®Ÿè£…äºˆå®š]
   - ãƒªãƒã‚¸ãƒˆãƒªå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢
   - ãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢ã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ¤œç´¢
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã‚„å±æ€§ã«ã‚ˆã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

5. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½** [åŸºæœ¬å®Ÿè£…æ¸ˆã¿]
   - é »ç¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
   - ãƒªãƒã‚¸ãƒˆãƒªæ§‹é€ ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
   - è¨­å®šæƒ…å ±ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
   - LLMãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ [âœ…å®Œäº†]

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: FastAPI
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: SQLiteï¼ˆé–‹ç™ºãƒ»æœ¬ç•ªå…±é€šï¼‰
- **ORM**: SQLAlchemy
- **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: Alembic
- **HTTP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ**: httpx
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: Redis ã¾ãŸã¯ in-memory
- **ãƒ†ã‚¹ãƒˆ**: pytest
- **ã‚³ãƒ³ãƒ†ãƒŠåŒ–**: Docker
- **ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼**: black

3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨æ©Ÿèƒ½æœ€é©åŒ–**
   - ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹APIåˆ©ç”¨ã‚³ã‚¹ãƒˆå‰Šæ¸›
   - ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæœ€é©åŒ–
   - ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®ä¸€å…ƒç®¡ç†

4. **Model Context Protocol (MCP) ã¨ã®é€£æº**
   - ç•°ãªã‚‹LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼é–“ã§ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†æ¨™æº–åŒ–
   - Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰æŠ½å‡ºã—ãŸæƒ…å ±ã‚’æ§‹é€ åŒ–ã•ã‚ŒãŸå½¢å¼ã§LLMã«æä¾›
   - æ—¢å­˜ã®å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆMarkdownProcessor, LinkTransformerï¼‰ã®æ´»ç”¨

### å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

1. **LLMã‚µãƒ¼ãƒ“ã‚¹æŠ½è±¡åŒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¿½åŠ **
   - åŸºåº•ã‚¯ãƒ©ã‚¹ `LLMServiceBase` ã®å®Ÿè£…
   - ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å›ºæœ‰ã®å®Ÿè£…ï¼ˆOpenAI, Anthropicç­‰ï¼‰
   - `LLMServiceFactory` ã«ã‚ˆã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã®æŠ½è±¡åŒ–

2. **MCPã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®å®Ÿè£…**
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’MCPãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¤‰æ›
   - ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®æœ€é©åŒ–ã¨æ§‹é€ åŒ–

3. **APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®æ‹¡å¼µ**
   - LLMå•ã„åˆã‚ã›ç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è¿½åŠ 
   - ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†APIã®å®Ÿè£…

ã“ã®æ‹¡å¼µã¯æ—¢å­˜ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆç‰¹ã«ã‚µãƒ¼ãƒ“ã‚¹æŠ½è±¡åŒ–ã¨ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰ã¨è‡ªç„¶ã«çµ±åˆã•ã‚Œã€å°†æ¥çš„ãªLLMçµ±åˆã®åŸºç›¤ã¨ãªã‚Šã¾ã™ã€‚

## ç¾åœ¨ã®é–‹ç™ºçŠ¶æ³

### å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½
- ç’°å¢ƒæ§‹ç¯‰å®Œäº†
- ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆä½œæˆæ¸ˆã¿
- åŸºæœ¬çš„ãªAPIãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®è¨­å®šå®Œäº†
- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯APIã®å®Ÿè£…å®Œäº†
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå–å¾—APIã®åŸºæœ¬æ©Ÿèƒ½å®Ÿè£…å®Œäº†
- ãƒªãƒã‚¸ãƒˆãƒªæ§‹é€ å–å¾—APIã®åŸºæœ¬æ©Ÿèƒ½å®Ÿè£…å®Œäº†
- Mockã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…å®Œäº†ï¼ˆé–‹ç™ºãƒ»ãƒ‡ãƒ¢ãƒ»ãƒ†ã‚¹ãƒˆç”¨ï¼‰
- Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‡¦ç†æ©Ÿèƒ½ã®å®Œå…¨å®Ÿè£…ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼è§£æã€ãƒªãƒ³ã‚¯å¤‰æ›ãªã©ï¼‰

### å®Ÿè£…æ–¹é‡ã®æ˜ç¢ºåŒ–
- Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå¯¾å¿œã‚’æœ€å„ªå…ˆã§å®Ÿè£…ï¼ˆâœ…å®Œäº†ï¼‰
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å±¤ã¯ãƒ¢ãƒƒã‚¯ã§å®Ÿè£…ï¼ˆAPIã®ä»•æ§˜ãŒå®šã¾ã£ãŸæ®µéšã§ãƒ¢ãƒ‡ãƒ«å®šç¾©ã‚’è¡Œã†ï¼‰
- Quartoå¯¾å¿œã¯å°†æ¥ã®æ‹¡å¼µã¨ã—ã¦ä½ç½®ä»˜ã‘
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰çµŒç”±LLM APIé€£æºã‚’å„ªå…ˆçš„ã«å®Ÿè£…

### é€²è¡Œä¸­ã®æ©Ÿèƒ½
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰çµŒç”±LLM APIé€£æºã®å®Ÿè£… [ğŸ”„å„ªå…ˆå®Ÿè£…é …ç›®]
- ãƒªãƒã‚¸ãƒˆãƒªç®¡ç†æ©Ÿèƒ½ã®å®Ÿè£…
- æ¤œç´¢æ©Ÿèƒ½ã®å®Ÿè£…
- APIã®æ‹¡å¼µï¼ˆQuartoå¯¾å¿œã‚’è¦‹æ®ãˆãŸæ©Ÿèƒ½ï¼‰

### æœªç€æ‰‹ã®æ©Ÿèƒ½
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å±¤ã®æœ¬æ ¼çš„ãªå®Ÿè£…
- Quartoãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå¯¾å¿œã®è¿½åŠ 
- æœ¬ç•ªç’°å¢ƒæº–å‚™

### é–‹ç™ºã‚¹ãƒ†ãƒƒãƒ—
1. **åŸºæœ¬APIå®šç¾©ã®å®Œäº†** [âœ…å®Œäº†]
   - RESTful APIã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©
   - ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®Pydanticãƒ¢ãƒ‡ãƒ«å®šç¾©
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å®Ÿè£…

2. **ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®å®Ÿè£…** [âœ…å®Œäº†]
   - æŠ½è±¡Gitã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…ï¼ˆ`services/git/base.py`ï¼‰
   - GitHubå®Ÿè£…ï¼ˆ`services/git/github_service.py`ï¼‰
   - Mockå®Ÿè£…ï¼ˆ`services/git/mock_service.py`ï¼‰
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‡¦ç†ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆ`services/document_service.py`ï¼‰
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆåŸºæœ¬å®Ÿè£…ï¼‰

3. **ãƒ¢ãƒƒã‚¯ã‚’ç”¨ã„ãŸAPIã®å‹•ä½œç¢ºèª** [âœ…å®Œäº†]
   - å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãªã—ã§ã‚µãƒ¼ãƒ“ã‚¹å±¤ã‚’ãƒ¢ãƒƒã‚¯ã—ã¦APIã®å‹•ä½œã‚’ç¢ºèª
   - ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®æ‰‹æ³•ã‚’æ´»ç”¨ã—ã€APIã®æœŸå¾…ã™ã‚‹å‹•ä½œã‚’ãƒ†ã‚¹ãƒˆã§å®šç¾©

4. **Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå¯¾å¿œã®æ‹¡å¼µ** [âœ…å®Œäº†]
   - Markdownãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼è§£æ
   - ç›¸å¯¾ãƒªãƒ³ã‚¯ã®çµ¶å¯¾ãƒ‘ã‚¹å¤‰æ›æ©Ÿèƒ½
   - ãƒªãƒ³ã‚¯æƒ…å ±ã®æŠ½å‡ºã¨æä¾›
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®æ‹¡å……
   
5. **APIã®æ‹¡å¼µï¼ˆQuartoå¯¾å¿œã‚’è¦‹æ®ãˆãŸæ©Ÿèƒ½ï¼‰** [ğŸ”„è¨ˆç”»ä¸­]
   - Quartoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¤œå‡ºæ©Ÿèƒ½ã®è¿½åŠ 
   - ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã¨å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®é–¢é€£ä»˜ã‘ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
   - ãƒªãƒ³ã‚¯å¤‰æ›ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è¿½åŠ 
   - ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼è§£æã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æä¾›æ©Ÿèƒ½ã®æ‹¡å¼µ
   - ãƒªãƒã‚¸ãƒˆãƒªè¨­å®šãƒ¢ãƒ‡ãƒ«ã¨APIã®è¿½åŠ 

6. **LLM APIé€£æºã®å®Ÿè£…** [ğŸ”„å„ªå…ˆå®Ÿè£…äºˆå®š]
   - LLMã‚µãƒ¼ãƒ“ã‚¹æŠ½è±¡åŒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å®Ÿè£…ï¼ˆ`services/llm/base.py`ï¼‰
   - ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å›ºæœ‰ã®å®Ÿè£…ï¼ˆOpenAI, Anthropicç­‰ï¼‰
   - `LLMServiceFactory` ã®å®Ÿè£…ï¼ˆ`services/llm/factory.py`ï¼‰
   - MCPã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®å®Ÿè£…ï¼ˆ`services/llm/mcp_adapter.py`ï¼‰
   - LLMå•ã„åˆã‚ã›ç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è¿½åŠ ï¼ˆ`api/endpoints/llm.py`ï¼‰
   - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†æ©Ÿèƒ½ã®å®Ÿè£…
   - ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å®Ÿè£…

7. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å±¤ã®å®Ÿè£…** [ğŸ”„é€²è¡Œäºˆå®š]
   - SQLAlchemyã®Baseã‚¯ãƒ©ã‚¹ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã®è¨­å®šï¼ˆ`db/database.py`ï¼‰
   - ãƒ¢ãƒ‡ãƒ«å®šç¾©ï¼ˆ`db/models.py`ï¼‰
   - ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤ã®å®Ÿè£…ï¼ˆ`db/repositories/`ï¼‰
   - Alembicã«ã‚ˆã‚‹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
   - ãƒªãƒã‚¸ãƒˆãƒªè¨­å®šãƒ»ãƒãƒƒãƒ”ãƒ³ã‚°æ©Ÿèƒ½ã®è¿½åŠ 

8. **Quartoãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå¯¾å¿œã®è¿½åŠ ** [â±ï¸æœªç€æ‰‹]
   - Quartoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šï¼ˆ_quarto.ymlï¼‰ã®è§£æ
   - ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«(.qmd)ã¨å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«(.html)ã®é–¢é€£ä»˜ã‘
   - ãƒªãƒã‚¸ãƒˆãƒªæ§‹é€ åˆ†æã¨ãƒ‘ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚°
   - ã‚µã‚¤ãƒˆæ§‹é€ æƒ…å ±ã®æä¾›

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: FastAPI
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: SQLiteï¼ˆé–‹ç™ºãƒ»æœ¬ç•ªå…±é€šï¼‰
- **ORM**: SQLAlchemy
- **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: Alembic
- **HTTP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ**: httpx
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: Redis ã¾ãŸã¯ in-memory
- **ãƒ†ã‚¹ãƒˆ**: pytest
- **ã‚³ãƒ³ãƒ†ãƒŠåŒ–**: Docker
- **ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼**: black

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š

```
doc_ai_helper_backend/
â”œâ”€â”€ doc_ai_helper_backend/         # ãƒ¡ã‚¤ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                    # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ api/                       # APIå±¤
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ api.py                 # APIãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š
â”‚   â”‚   â”œâ”€â”€ dependencies.py        # ä¾å­˜é–¢ä¿‚æ³¨å…¥
â”‚   â”‚   â”œâ”€â”€ error_handlers.py      # ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”‚   â”‚   â””â”€â”€ endpoints/             # ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ documents.py       # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå–å¾—API
â”‚   â”‚       â”œâ”€â”€ health.py          # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯API
â”‚   â”‚       â”œâ”€â”€ repositories.py    # ãƒªãƒã‚¸ãƒˆãƒªç®¡ç†API
â”‚   â”‚       â”œâ”€â”€ search.py          # æ¤œç´¢API
â”‚   â”‚       â””â”€â”€ llm.py             # LLM APIï¼ˆè¨ˆç”»ä¸­ï¼‰
â”‚   â”œâ”€â”€ core/                      # ã‚³ã‚¢æ©Ÿèƒ½
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py              # è¨­å®šç®¡ç†
â”‚   â”‚   â”œâ”€â”€ exceptions.py          # ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–
â”‚   â”‚   â””â”€â”€ logging.py             # ãƒ­ã‚®ãƒ³ã‚°è¨­å®š
â”‚   â”œâ”€â”€ db/                        # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å±¤
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ repositories/          # ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³
â”‚   â”‚       â””â”€â”€ __pycache__/
â”‚   â”œâ”€â”€ models/                    # ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ document.py            # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ¢ãƒ‡ãƒ«
â”‚   â”‚   â”œâ”€â”€ frontmatter.py         # ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼ãƒ¢ãƒ‡ãƒ«
â”‚   â”‚   â”œâ”€â”€ link_info.py           # ãƒªãƒ³ã‚¯æƒ…å ±ãƒ¢ãƒ‡ãƒ«
â”‚   â”‚   â”œâ”€â”€ repository.py          # ãƒªãƒã‚¸ãƒˆãƒªãƒ¢ãƒ‡ãƒ«
â”‚   â”‚   â””â”€â”€ search.py              # æ¤œç´¢ãƒ¢ãƒ‡ãƒ«
â”‚   â”œâ”€â”€ services/                  # ã‚µãƒ¼ãƒ“ã‚¹å±¤
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ document_service.py    # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‡¦ç†ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”œâ”€â”€ document_processors/   # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base_processor.py   # åŸºåº•ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼
â”‚   â”‚   â”‚   â”œâ”€â”€ factory.py          # ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ãƒ•ã‚¡ã‚¯ãƒˆãƒª
â”‚   â”‚   â”‚   â”œâ”€â”€ frontmatter_parser.py # ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼è§£æ
â”‚   â”‚   â”‚   â”œâ”€â”€ link_transformer.py   # ãƒªãƒ³ã‚¯å¤‰æ›
â”‚   â”‚   â”‚   â””â”€â”€ markdown_processor.py # Markdownå‡¦ç†
â”‚   â”‚   â””â”€â”€ git/                   # Gitã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ base.py            # GitåŸºæœ¬ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚       â”œâ”€â”€ factory.py         # Gitã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚¯ãƒˆãƒª
â”‚   â”‚       â”œâ”€â”€ github_service.py  # GitHubå®Ÿè£…
â”‚   â”‚       â””â”€â”€ mock_service.py    # ãƒ¢ãƒƒã‚¯å®Ÿè£…
â”‚   â””â”€â”€ utils/                     # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ errors.py              # ã‚¨ãƒ©ãƒ¼ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”œâ”€â”€ services/llm/              # LLMã‚µãƒ¼ãƒ“ã‚¹ï¼ˆè¨ˆç”»ä¸­ï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py                # LLMåŸºæœ¬ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”œâ”€â”€ factory.py             # LLMã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚¯ãƒˆãƒª
â”‚   â”‚   â”œâ”€â”€ openai_service.py      # OpenAIå®Ÿè£…
â”‚   â”‚   â”œâ”€â”€ anthropic_service.py   # Anthropicå®Ÿè£…
â”‚   â”‚   â””â”€â”€ mcp_adapter.py         # Model Context Protocol ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼
â”œâ”€â”€ tests/                         # ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py                # ãƒ†ã‚¹ãƒˆè¨­å®š
â”‚   â”œâ”€â”€ api/                       # APIãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ test_documents.py      # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆAPIãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â””â”€â”€ test_health.py         # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯APIãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ integration/               # çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â””â”€â”€ unit/                      # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
â”‚       â””â”€â”€ __init__.py
â”œâ”€â”€ data/                          # ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”œâ”€â”€ docker-compose.yml             # Docker Composeè¨­å®š
â”œâ”€â”€ Dockerfile                     # Dockerè¨­å®š
â”œâ”€â”€ README.md                      # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª¬æ˜
â”œâ”€â”€ requirements.lock              # å›ºå®šä¾å­˜é–¢ä¿‚
â”œâ”€â”€ requirements.txt               # ä¾å­˜é–¢ä¿‚
â””â”€â”€ setup.py                       # ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```

## å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®è©³ç´°

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¯ `main.py` ã§ã‚ã‚Šã€FastAPIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–ã€CORSãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®è¨­å®šã€APIãƒ«ãƒ¼ã‚¿ãƒ¼ã®ãƒã‚¦ãƒ³ãƒˆã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®è¨­å®šã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

```python
# main.py
app = FastAPI(
    title="Document AI Helper API",
    description="API for Document AI Helper",
    version=settings.app_version,
    debug=settings.debug,
)

# Set up CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # Modify in production to specific origins
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Include API router
app.include_router(api_router)
```

### APIãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

APIãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯ `api.py` ã§å®šç¾©ã•ã‚Œã€å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ã‚¿ãƒ¼ã«çµ±åˆã—ã¦ã„ã¾ã™ã€‚

```python
# api.py
router = APIRouter(prefix=settings.api_prefix)

# Include routers for different endpoints
router.include_router(health_router, prefix="/health")
router.include_router(documents_router, prefix="/documents")
router.include_router(repositories_router, prefix="/repositories")
router.include_router(search_router, prefix="/search")
router.include_router(llm_router, prefix="/llm")  # è¨ˆç”»ä¸­ã®LLM APIãƒ«ãƒ¼ã‚¿ãƒ¼
```

### ä¾å­˜é–¢ä¿‚æ³¨å…¥

ä¾å­˜é–¢ä¿‚ã®æ³¨å…¥ã¯ `dependencies.py` ã§è¡Œã‚ã‚Œã€ã‚µãƒ¼ãƒ“ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ç”Ÿæˆã¨æä¾›ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ†ã‚¹ãƒˆæ™‚ã«ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ³¨å…¥ã™ã‚‹ã“ã¨ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚

### Gitã‚µãƒ¼ãƒ“ã‚¹æŠ½è±¡åŒ–

Gitã‚µãƒ¼ãƒ“ã‚¹ã¯æŠ½è±¡åŸºåº•ã‚¯ãƒ©ã‚¹ `GitServiceBase` ã‚’å®Ÿè£…ã—ã¦ãŠã‚Šã€ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã—ã¦å…·ä½“çš„ãªå®Ÿè£…ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```python
# factory.py
class GitServiceFactory:
    """Factory for creating Git service instances."""

    # Registry of available Git services
    _services: Dict[str, Type[GitServiceBase]] = {
        "github": GitHubService,
        "mock": MockGitService,
    }

    @classmethod
    def create(
        cls, service_type: str, access_token: Optional[str] = None
    ) -> GitServiceBase:
        # å®Ÿè£…
```

### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ `/api/endpoints/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå–å¾—APIã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ï¼š

```python
# documents.py
@router.get(
    "/contents/{service}/{owner}/{repo}/{path:path}",
    response_model=DocumentResponse,
    summary="Get document",
    description="Get document from a Git repository",
)
async def get_document(
    service: str = Path(..., description="Git service (github, gitlab, etc.)"),
    owner: str = Path(..., description="Repository owner"),
    repo: str = Path(..., description="Repository name"),
    path: str = Path(..., description="Document path"),
    ref: Optional[str] = Query(default="main", description="Branch or tag name"),
    transform_links: bool = Query(
        default=True, description="Transform relative links to absolute"
    ),
    base_url: Optional[str] = Query(
        default=None, description="Base URL for link transformation"
    ),
    document_service: DocumentService = Depends(get_document_service),
):
    # å®Ÿè£…
```

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ¢ãƒ‡ãƒ«

```python
# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«
class DocumentResponse(BaseModel):
    path: str                   # ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
    name: str                   # ãƒ•ã‚¡ã‚¤ãƒ«å
    type: DocumentType          # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¿ã‚¤ãƒ—
    content: DocumentContent    # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„
    metadata: DocumentMetadata  # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
    repository: str             # ãƒªãƒã‚¸ãƒˆãƒªå
    owner: str                  # ãƒªãƒã‚¸ãƒˆãƒªã‚ªãƒ¼ãƒŠãƒ¼
    service: str                # Gitã‚µãƒ¼ãƒ“ã‚¹
    ref: str                    # ãƒ–ãƒ©ãƒ³ãƒã¾ãŸã¯ã‚¿ã‚°
    links: List[LinkInfo]       # ãƒªãƒ³ã‚¯æƒ…å ±
    transformed_content: Optional[str]  # ãƒªãƒ³ã‚¯å¤‰æ›æ¸ˆã¿ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
    # è¨ˆç”»ä¸­ã®æ‹¡å¼µãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    # relations: Optional[DocumentRelations]  # é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæƒ…å ±ï¼ˆå°†æ¥å®Ÿè£…äºˆå®šï¼‰
```

### ãƒªãƒ³ã‚¯æƒ…å ±ãƒ¢ãƒ‡ãƒ«

```python
# ãƒªãƒ³ã‚¯æƒ…å ±ãƒ¢ãƒ‡ãƒ«
class LinkInfo(BaseModel):
    text: str                  # ãƒªãƒ³ã‚¯ãƒ†ã‚­ã‚¹ãƒˆ
    url: str                   # ãƒªãƒ³ã‚¯URL
    is_image: bool             # ç”»åƒãƒªãƒ³ã‚¯ã‹ã©ã†ã‹
    position: Tuple[int, int]  # ãƒªãƒ³ã‚¯ã®ä½ç½®ï¼ˆé–‹å§‹,çµ‚äº†ï¼‰
    is_external: bool          # å¤–éƒ¨ãƒªãƒ³ã‚¯ã‹ã©ã†ã‹
```

### æ‹¡å¼µãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

```python
# æ‹¡å¼µãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
class ExtendedDocumentMetadata(BaseModel):
    filename: str              # ãƒ•ã‚¡ã‚¤ãƒ«å
    extension: str             # ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­
    frontmatter: Dict[str, Any] # ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿
    title: Optional[str]       # ã‚¿ã‚¤ãƒˆãƒ«
    description: Optional[str] # èª¬æ˜
    author: Optional[str]      # è‘—è€…
    date: Optional[str]        # æ—¥ä»˜
    tags: List[str]            # ã‚¿ã‚°
```

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¨­å®šãƒ¢ãƒ‡ãƒ«ï¼ˆè¨ˆç”»ä¸­ï¼‰

```python
# ãƒ‘ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ¢ãƒ‡ãƒ«ï¼ˆå°†æ¥çš„ãªQuartoã‚µãƒãƒ¼ãƒˆã§ä½¿ç”¨ï¼‰
class PathMapping(BaseModel):
    source_dir: str             # ã‚½ãƒ¼ã‚¹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆä¾‹: 'src'ï¼‰
    output_dir: str             # å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆä¾‹: '_site'ï¼‰
    source_ext: List[str]       # ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­ï¼ˆä¾‹: ['qmd', 'md']ï¼‰
    output_ext: str = "html"    # å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­

# ãƒªãƒã‚¸ãƒˆãƒªè¨­å®šãƒ¢ãƒ‡ãƒ«
class RepositorySettings(BaseModel):
    document_type: DocumentType  # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ï¼ˆmarkdown, quartoç­‰ï¼‰
    # Markdownã®ã¿ã®å ´åˆã¯ä»¥ä¸‹ã¯ä¸è¦
    config_file: Optional[str] = None  # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ_quarto.ymlç­‰ï¼‰
    path_mappings: Optional[List[PathMapping]] = None  # ãƒ‘ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚°è¨­å®šï¼ˆQuartoç”¨ï¼‰
    ## ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

1. **FastAPIãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**
   - ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã¯é©åˆ‡ãª`response_model`ã‚’è¨­å®šã™ã‚‹
   - Path, Query, Bodyãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã¯ã™ã¹ã¦èª¬æ˜ã‚’ä»˜ä¸ã™ã‚‹
   - ä¾å­˜é–¢ä¿‚ã®æ³¨å…¥ã‚’ç©æ¥µçš„ã«æ´»ç”¨ã™ã‚‹

2. **ã‚¿ã‚¤ãƒ—ãƒ’ãƒ³ãƒˆ**
   - ã™ã¹ã¦ã®é–¢æ•°ã¨ãƒ¡ã‚½ãƒƒãƒ‰ã«ã¯é©åˆ‡ãªã‚¿ã‚¤ãƒ—ãƒ’ãƒ³ãƒˆã‚’ä»˜ä¸ã™ã‚‹
   - è¤‡é›‘ãªå‹ã¯`typing`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’æ´»ç”¨ã™ã‚‹

3. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
   - ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ã‚’é©åˆ‡ã«ä½¿ç”¨ã™ã‚‹
   - APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§ã¯é©åˆ‡ãªHTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¿”ã™
   - æ˜ç¢ºãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æä¾›ã™ã‚‹

4. **ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º**
   - æ–°æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹å‰ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
   - ãƒ¢ãƒƒã‚¯ã‚’æ´»ç”¨ã—ã¦å¤–éƒ¨ä¾å­˜é–¢ä¿‚ã‚’åˆ†é›¢ã™ã‚‹
   - å˜ä½“ãƒ†ã‚¹ãƒˆã¨çµ±åˆãƒ†ã‚¹ãƒˆã®ä¸¡æ–¹ã‚’ä½œæˆã™ã‚‹

5. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**
   - ã‚³ãƒ¼ãƒ‰ã«ã¯Docstringã‚’ä»˜ä¸ã™ã‚‹
   - APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã¯é©åˆ‡ãªèª¬æ˜ã‚’ä»˜ä¸ã™ã‚‹
   - README.mdã¯æœ€æ–°ã®çŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹

6. **ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«**
   - blackãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ã«å¾“ã†
   - ä¸€è²«æ€§ã®ã‚ã‚‹å‘½åè¦å‰‡ã‚’ä½¿ç”¨ã™ã‚‹
   - é©åˆ‡ãªé–¢æ•°/ãƒ¡ã‚½ãƒƒãƒ‰ã®åˆ†å‰²ã‚’è¡Œã†

7. **é–‹ç™ºå„ªå…ˆé †ä½**
   - Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå¯¾å¿œã‚’æœ€å„ªå…ˆã§å®Ÿè£… [âœ…å®Œäº†]
   - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰çµŒç”±LLM APIé€£æºã‚’å„ªå…ˆçš„ã«å®Ÿè£… [ğŸ”„å„ªå…ˆå®Ÿè£…é …ç›®]
   - ãƒªãƒã‚¸ãƒˆãƒªç®¡ç†æ©Ÿèƒ½ã®å®Ÿè£…ã‚’é€²ã‚ã‚‹
   - æ¤œç´¢æ©Ÿèƒ½ã®å®Ÿè£…ã‚’é€²ã‚ã‚‹
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã‚’å¼·åŒ–ã™ã‚‹
   - Quartoå¯¾å¿œã¯å°†æ¥ã®æ‹¡å¼µã¨ã—ã¦ä½ç½®ä»˜ã‘ã‚‹
```

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‡¦ç†ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‡¦ç†ã¯ä»¥ä¸‹ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ï¼š

### åŸºåº•ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ (BaseProcessor)

ã™ã¹ã¦ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ã®åŸºåº•ã‚¯ãƒ©ã‚¹ã¨ã—ã¦æ©Ÿèƒ½ã—ã€å…±é€šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©ã—ã¾ã™ã€‚

```python
class DocumentProcessorBase(ABC):
    @abstractmethod
    def process_content(self, content: str, path: str) -> "DocumentContent":
        """ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å‡¦ç†ã™ã‚‹"""
        pass
        
    @abstractmethod
    def extract_metadata(self, content: str, path: str) -> "DocumentMetadata":
        """ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã™ã‚‹"""
        pass
        
    @abstractmethod
    def extract_links(self, content: str, base_path: str) -> List["LinkInfo"]:
        """ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰ãƒªãƒ³ã‚¯æƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹"""
        pass
        
    @abstractmethod
    def transform_links(self, content: str, links: List["LinkInfo"], base_url: str) -> str:
        """ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã®ãƒªãƒ³ã‚¯ã‚’å¤‰æ›ã™ã‚‹"""
        pass
```

### Markdownãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ (MarkdownProcessor)

Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ç‰¹åŒ–ã—ãŸå‡¦ç†ã‚’è¡Œã†ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ã§ã™ã€‚

```python
class MarkdownProcessor(DocumentProcessorBase):
    """Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‡¦ç†ã‚¯ãƒ©ã‚¹"""
    
    # å®Ÿè£…ãƒ¡ã‚½ãƒƒãƒ‰
    def process_content(self, content: str, path: str) -> DocumentContent:
        # Markdownã®å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯
        
    def extract_metadata(self, content: str, path: str) -> DocumentMetadata:
        # ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼ã®è§£æã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æŠ½å‡º
        
    def extract_links(self, content: str, base_path: str) -> List[LinkInfo]:
        # Markdownãƒªãƒ³ã‚¯ã®æ¤œå‡ºã¨æƒ…å ±æŠ½å‡º
        
    def transform_links(self, content: str, links: List[LinkInfo], base_url: str) -> str:
        # ç›¸å¯¾ãƒªãƒ³ã‚¯ã®çµ¶å¯¾ãƒ‘ã‚¹å¤‰æ›
```

### ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼ãƒ‘ãƒ¼ã‚µãƒ¼ (FrontmatterParser)

Markdownãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼ã‚’è§£æã™ã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã§ã™ã€‚

```python
def parse_frontmatter(content: str) -> Tuple[Dict[str, Any], str]:
    """
    Markdownã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‹ã‚‰ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼ã‚’è§£æã™ã‚‹ã€‚
    
    Returns:
        (ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼è¾æ›¸, ãƒ•ãƒ­ãƒ³ãƒˆãƒãƒ¼é™¤å»æ¸ˆã¿ã‚³ãƒ³ãƒ†ãƒ³ãƒ„)ã®ã‚¿ãƒ—ãƒ«
    """
    # python-frontmatterã‚’ä½¿ç”¨ã—ãŸå®Ÿè£…
```

### ãƒªãƒ³ã‚¯å¤‰æ› (LinkTransformer)

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã®ãƒªãƒ³ã‚¯ã‚’æ¤œå‡ºã—ã€å¤‰æ›ã™ã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã§ã™ã€‚

```python
class LinkTransformer:
    """Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã®ãƒªãƒ³ã‚¯ã‚’å¤‰æ›ã™ã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¯ãƒ©ã‚¹ã€‚"""
    
    @staticmethod
    def transform_relative_links(content: str, base_url: str, base_path: str) -> str:
        """ç›¸å¯¾ãƒªãƒ³ã‚¯ã‚’çµ¶å¯¾ãƒ‘ã‚¹ã«å¤‰æ›ã™ã‚‹"""
        
    @staticmethod
    def extract_links(content: str, is_markdown: bool = True) -> List[LinkInfo]:
        """ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰ãƒªãƒ³ã‚¯æƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹"""
```

### ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ (ProcessorFactory)

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸé©åˆ‡ãªãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ã‚’ç”Ÿæˆã™ã‚‹ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ã‚¯ãƒ©ã‚¹ã§ã™ã€‚

```python
class DocumentProcessorFactory:
    """ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ã‚’ç”Ÿæˆã™ã‚‹ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ã‚¯ãƒ©ã‚¹ã€‚"""
    
    # åˆ©ç”¨å¯èƒ½ãªãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼
    _processors: Dict[DocumentType, Type[DocumentProcessorBase]] = {
        DocumentType.MARKDOWN: MarkdownProcessor,
        # å°†æ¥çš„ã«Quartoã‚„HTMLã‚’è¿½åŠ 
    }
    
    @classmethod
    def create(cls, document_type: DocumentType) -> DocumentProcessorBase:
        """ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ã‚’ç”Ÿæˆã™ã‚‹"""
```

## LLM APIé€£æºã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

LLM APIé€£æºã¯ä»¥ä¸‹ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§æ§‹æˆã•ã‚Œã‚‹äºˆå®šã§ã™ï¼š

### åŸºåº•LLMã‚µãƒ¼ãƒ“ã‚¹ (LLMServiceBase)

ã™ã¹ã¦ã®LLMã‚µãƒ¼ãƒ“ã‚¹ã®åŸºåº•ã‚¯ãƒ©ã‚¹ã¨ã—ã¦æ©Ÿèƒ½ã—ã€å…±é€šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©ã—ã¾ã™ã€‚

```python
class LLMServiceBase(ABC):
    @abstractmethod
    async def query(self, prompt: str, options: Dict[str, Any] = None) -> LLMResponse:
        """LLMã¸ã®å•ã„åˆã‚ã›ã‚’è¡Œã†"""
        pass
        
    @abstractmethod
    async def get_capabilities(self) -> Dict[str, Any]:
        """LLMã®æ©Ÿèƒ½ã¨åˆ¶é™ã‚’å–å¾—ã™ã‚‹"""
        pass
        
    @abstractmethod
    async def format_prompt(self, template_id: str, variables: Dict[str, Any]) -> str:
        """ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹"""
        pass
```

### LLMã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£… (OpenAIService, AnthropicService ãªã©)

å„LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«ç‰¹åŒ–ã—ãŸã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…ã§ã™ã€‚

```python
class OpenAIService(LLMServiceBase):
    """OpenAI APIå®Ÿè£…"""
    
    def __init__(self, api_key: str, default_model: str = "gpt-4", **kwargs):
        self.client = OpenAI(api_key=api_key)
        self.default_model = default_model
        self.default_options = kwargs
    
    async def query(self, prompt: str, options: Dict[str, Any] = None) -> LLMResponse:
        # OpenAIå›ºæœ‰ã®å®Ÿè£…
        
    async def get_capabilities(self) -> Dict[str, Any]:
        # OpenAIå›ºæœ‰ã®æ©Ÿèƒ½ã¨åˆ¶é™
        
    async def format_prompt(self, template_id: str, variables: Dict[str, Any]) -> str:
        # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å‡¦ç†
```

### LLMã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ (LLMServiceFactory)

LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«å¿œã˜ãŸé©åˆ‡ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ã‚¯ãƒ©ã‚¹ã§ã™ã€‚

```python
class LLMServiceFactory:
    """LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«å¿œã˜ãŸã‚µãƒ¼ãƒ“ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ã‚¯ãƒ©ã‚¹ã€‚"""
    
    # åˆ©ç”¨å¯èƒ½ãªã‚µãƒ¼ãƒ“ã‚¹
    _services: Dict[str, Type[LLMServiceBase]] = {        "openai": OpenAIService,
        "anthropic": AnthropicService,
        "gemini": GeminiService,
        # å°†æ¥çš„ã«ä»–ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’è¿½åŠ 
    }
    
    @classmethod
    def create(cls, provider: str, **config) -> LLMServiceBase:
        """ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«å¿œã˜ãŸLLMã‚µãƒ¼ãƒ“ã‚¹ã‚’ç”Ÿæˆã™ã‚‹"""
```

## ä¸»è¦æ©Ÿèƒ½

1. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå–å¾—API** [âœ…åŸºæœ¬å®Ÿè£…æ¸ˆã¿]
   - æ§˜ã€…ãªGitã‚µãƒ¼ãƒ“ã‚¹ï¼ˆGitHub, Mockç­‰ï¼‰ã‹ã‚‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå–å¾—
   - Markdownãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—ã¨æä¾›
   - ãƒªãƒã‚¸ãƒˆãƒªæ§‹é€ ã®å–å¾—
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ãƒªãƒ³ã‚¯ã®è§£æã¨å¤‰æ› [âœ…å®Œäº†]
   - ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼ã®è§£æã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æä¾› [âœ…å®Œäº†]
   - HTMLãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—ã¨æä¾›ï¼ˆåŸºæœ¬å®Ÿè£…æ¸ˆã¿ï¼‰
   - Quarto/HTMLãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚½ãƒ¼ã‚¹ã¨å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®é–¢é€£ä»˜ã‘ï¼ˆå°†æ¥å¯¾å¿œï¼‰

2. **ãƒªãƒã‚¸ãƒˆãƒªç®¡ç†API** [ğŸ”„å®Ÿè£…äºˆå®š]
   - ãƒªãƒã‚¸ãƒˆãƒªæƒ…å ±ã®CRUDæ“ä½œ
   - ãƒªãƒã‚¸ãƒˆãƒªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†
   - Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¨­å®šã®ç®¡ç†
   - å°†æ¥çš„ã«ã¯Quartoãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¨­å®šï¼ˆãƒ‘ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚°ã€å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãªã©ï¼‰ã®ç®¡ç†
   - ãƒªãƒã‚¸ãƒˆãƒªã‚¿ã‚¤ãƒ—ï¼ˆMarkdown/Quartoï¼‰ã®æ¤œå‡ºã¨ç®¡ç†

3. **LLM APIé€£æº** [âœ…éƒ¨åˆ†çš„ã«å®Œäº†]
   - å¤–éƒ¨LLMã‚µãƒ¼ãƒ“ã‚¹ï¼ˆOpenAIï¼‰ã¨ã®çµ±åˆ [âœ…å®Œäº†]
   - ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚µãƒãƒ¼ãƒˆ [âœ…å®Œäº†]
   - SSEï¼ˆServer-Sent Eventsï¼‰ã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¿œç­” [âœ…å®Œäº†]
   - Model Context Protocol (MCP) å¯¾å¿œ [âœ…åŸºæœ¬å®Ÿè£…å®Œäº†]
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æ´»ç”¨ã—ãŸLLMå•ã„åˆã‚ã› [âœ…å®Œäº†]
   - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç† [âœ…å®Œäº†]
   - ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ [âœ…å®Œäº†]
   - è¿½åŠ ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å®Ÿè£…ï¼ˆOllamaï¼‰ [ğŸ”„é€²è¡Œä¸­]
   - MCPã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®æ‹¡å¼µæ©Ÿèƒ½ [ğŸ”„è¨ˆç”»ä¸­]

4. **æ¤œç´¢API** [ğŸ”„å®Ÿè£…äºˆå®š]
   - ãƒªãƒã‚¸ãƒˆãƒªå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢
   - ãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢ã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ¤œç´¢
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã‚„å±æ€§ã«ã‚ˆã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

5. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½** [åŸºæœ¬å®Ÿè£…æ¸ˆã¿]
   - é »ç¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
   - ãƒªãƒã‚¸ãƒˆãƒªæ§‹é€ ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
   - è¨­å®šæƒ…å ±ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
   - LLMãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ [âœ…å®Œäº†]

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: FastAPI
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: SQLiteï¼ˆé–‹ç™ºãƒ»æœ¬ç•ªå…±é€šï¼‰
- **ORM**: SQLAlchemy
- **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: Alembic
- **HTTP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ**: httpx
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: Redis ã¾ãŸã¯ in-memory
- **ãƒ†ã‚¹ãƒˆ**: pytest
- **ã‚³ãƒ³ãƒ†ãƒŠåŒ–**: Docker
- **ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼**: black
    }
    
    @classmethod
    def create(cls, provider: str, **config) -> LLMServiceBase:
        """ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«å¿œã˜ãŸLLMã‚µãƒ¼ãƒ“ã‚¹ã‚’ç”Ÿæˆã™ã‚‹"""
```

### MCPã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ (MCPAdapter)

Model Context Protocol ã«æº–æ‹ ã—ãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†ã‚’è¡Œã†ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã§ã™ã€‚

```python
class MCPAdapter:
    """Model Context Protocol ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼"""
    
    @staticmethod
    def convert_document_to_context(document: DocumentResponse) -> Dict[str, Any]:
        """ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’MCPã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›ã™ã‚‹"""
        
    @staticmethod
    def optimize_context(context: List[Dict[str, Any]], max_tokens: int) -> List[Dict[str, Any]]:
        """ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æœ€é©åŒ–ã™ã‚‹"""
```

### LLM APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

LLM APIé€£æºã®ãŸã‚ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚

```python
# llm.py
@router.post(
    "/query",
    response_model=LLMQueryResponse,
    summary="Query LLM",
    description="Send a query to LLM with document context",
)
async def query_llm(
    request: LLMQueryRequest,
    llm_service: LLMService = Depends(get_llm_service),
):
    # å®Ÿè£…
```